#!/usr/local/bin/node
require.paths.push(__dirname + '/../lib');

var paths = process.argv.slice(2);

var linter = require('jslint-linter');
var repository = require('repository').create();
var newFileReporter = require('new-file-reporter');
var lintReporter = require('lint-reporter');
var cleanReporter = require('clean-reporter');
var summaryReporter = require('summary-reporter');
var lintScanner = require('lint-scanner').create(linter);
var watchForLint = require('watch-for-lint');
var onInterrupt = require('on-interrupt');

repository.listenTo(linter);
watchForLint(repository, linter);

newFileReporter.listenTo(repository);

lintScanner.scan(paths).then(function () {
  newFileReporter.beVerbose();
  cleanReporter.listenTo(repository);
  lintReporter.listenTo(repository);
  //growlReporter.listenTo(repository); // listens to 'errorsFixed' and 'errorsIntroduced'
  summaryReporter.listenTo(repository);
  summaryReporter.print();
});

onInterrupt("Scanning for new files.", function () {
  lintReporter.mute();
  lintScanner.scan(paths).then(function () {
    summaryReporter.print();
    lintReporter.unmute();
  });
});
